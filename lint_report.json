
> antigravity-plus@0.0.19 lint
> eslint src --ext ts -f json

[{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\core\\auto-approve\\cdp-manager.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\core\\auto-approve\\circuit-breaker.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\core\\auto-approve\\controller.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\core\\auto-approve\\impact-tracker.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\core\\auto-approve\\operation-logger.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\core\\auto-approve\\performance-mode.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\core\\auto-approve\\poller.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\core\\auto-approve\\rules-engine.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\core\\auto-approve\\scripts\\full-cdp-script.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\core\\auto-wakeup\\controller.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\core\\auto-wakeup\\history.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\core\\auto-wakeup\\scheduler.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\core\\auto-wakeup\\system-scheduler.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\core\\auto-wakeup\\trigger.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\core\\quota-monitor\\api-client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\core\\quota-monitor\\controller.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\core\\quota-monitor\\countdown.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\core\\quota-monitor\\grouping.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\core\\quota-monitor\\process-detector.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\core\\quota-monitor\\quickpick.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ModelQuota' is defined but never used.","line":11,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'QuotaGroup' is defined but never used.","line":12,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":37},{"ruleId":"no-misleading-character-class","severity":2,"message":"Unexpected surrogate pair in character class. Use 'u' flag.","line":78,"column":51,"nodeType":"NewExpression","messageId":"surrogatePairWithoutUFlag","endLine":78,"endColumn":136,"suggestions":[{"messageId":"suggestUnicodeFlag","fix":{"range":[3214,3214],"text":", \"u\""},"desc":"Add unicode 'u' flag to regex."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * QuickPick Quota Display - é…é¡ QuickPick å‚™ç”¨æ¨¡å¼\r\n * \r\n * å°é½Š Antigravity Cockpit çš„ QuickPick æ¨¡å¼\r\n * - ç•¶ Webview ç„¡æ³•åŠ è¼‰æ™‚çš„å‚™ç”¨æ–¹æ¡ˆ\r\n * - æ”¯æ´åˆ†çµ„ / éåˆ†çµ„æ¨¡å¼\r\n * - æ¨™é¡Œæ¬„æŒ‰éˆ•ï¼šåˆ·æ–°ã€åˆ‡æ›åˆ†çµ„ã€é–‹å•Ÿæ—¥èªŒã€è¨­å®š\r\n */\r\n\r\nimport * as vscode from 'vscode';\r\nimport { QuotaData, ModelQuota } from './controller';\r\nimport { GroupingManager, QuotaGroup } from './grouping';\r\nimport { calculateCountdown } from './countdown';\r\nimport { t } from '../../i18n';\r\n\r\ninterface QuotaQuickPickItem extends vscode.QuickPickItem {\r\n    modelId?: string;\r\n    groupId?: string;\r\n    action?: 'refresh' | 'toggleGroup' | 'pin' | 'rename' | 'settings';\r\n}\r\n\r\nexport class QuickPickQuotaDisplay implements vscode.Disposable {\r\n    private disposables: vscode.Disposable[] = [];\r\n    private groupingEnabled: boolean = true;\r\n\r\n    constructor(\r\n        private groupingManager: GroupingManager\r\n    ) { }\r\n\r\n    /**\r\n     * é¡¯ç¤ºé…é¡ QuickPick\r\n     */\r\n    public async show(quotaData: QuotaData): Promise<void> {\r\n        const quickPick = vscode.window.createQuickPick<QuotaQuickPickItem>();\r\n        quickPick.title = 'ğŸ“Š Antigravity Plus - Quota Monitor';\r\n        quickPick.placeholder = t('quickpick.placeholder') || 'Select a model to view details or pin to status bar';\r\n        quickPick.matchOnDescription = true;\r\n        quickPick.matchOnDetail = true;\r\n\r\n        // å»ºç«‹é …ç›®\r\n        quickPick.items = this.buildItems(quotaData);\r\n\r\n        // è¨­å®šæŒ‰éˆ•\r\n        quickPick.buttons = [\r\n            {\r\n                iconPath: new vscode.ThemeIcon('refresh'),\r\n                tooltip: t('quickpick.refresh') || 'Refresh Quota'\r\n            },\r\n            {\r\n                iconPath: new vscode.ThemeIcon(this.groupingEnabled ? 'list-tree' : 'list-flat'),\r\n                tooltip: this.groupingEnabled\r\n                    ? (t('quickpick.disableGrouping') || 'Disable Grouping')\r\n                    : (t('quickpick.enableGrouping') || 'Enable Grouping')\r\n            },\r\n            {\r\n                iconPath: new vscode.ThemeIcon('gear'),\r\n                tooltip: t('quickpick.settings') || 'Settings'\r\n            }\r\n        ];\r\n\r\n        quickPick.onDidAccept(async () => {\r\n            const selected = quickPick.selectedItems[0];\r\n            if (!selected) return;\r\n\r\n            if (selected.action === 'pin' && selected.modelId) {\r\n                // ç½®é ‚æ¨¡å‹\r\n                await this.pinModel(selected.modelId);\r\n                vscode.window.showInformationMessage(`ğŸ“Œ ${selected.modelId} pinned to status bar`);\r\n            } else if (selected.action === 'pin' && selected.groupId) {\r\n                // ç½®é ‚åˆ†çµ„\r\n                this.groupingManager.togglePin(selected.groupId);\r\n                vscode.window.showInformationMessage(`ğŸ“Œ Group pinned`);\r\n            } else if (selected.action === 'rename' && selected.groupId) {\r\n                // é‡å‘½ååˆ†çµ„\r\n                const newName = await vscode.window.showInputBox({\r\n                    // Remove icons from start of label (Bar, Red, Yellow, Green, White circles)\r\n                    // using Unicode ranges or explicit code points to avoid source-code surrogates\r\n                    value: selected.label.replace(new RegExp(`^[${String.fromCodePoint(0x1F4CA, 0x1F534, 0x1F7E1, 0x1F7E2, 0x26AA)}] `), '')\r\n                });\r\n                if (newName) {\r\n                    this.groupingManager.rename(selected.groupId, newName);\r\n                    vscode.window.showInformationMessage(`âœï¸ Group renamed to ${newName}`);\r\n                }\r\n            }\r\n\r\n            quickPick.hide();\r\n        });\r\n\r\n        quickPick.onDidTriggerButton(async (button) => {\r\n            if (button.tooltip?.includes('Refresh')) {\r\n                // åˆ·æ–°\r\n                await vscode.commands.executeCommand('antigravity-plus.refreshQuota');\r\n                quickPick.hide();\r\n            } else if (button.tooltip?.includes('Grouping')) {\r\n                // åˆ‡æ›åˆ†çµ„\r\n                this.groupingEnabled = !this.groupingEnabled;\r\n                quickPick.items = this.buildItems(quotaData);\r\n                quickPick.buttons = this.updateButtons();\r\n            } else if (button.tooltip?.includes('Settings')) {\r\n                // é–‹å•Ÿè¨­å®š\r\n                await vscode.commands.executeCommand('workbench.action.openSettings', 'antigravity-plus.quota');\r\n                quickPick.hide();\r\n            }\r\n        });\r\n\r\n        quickPick.onDidHide(() => {\r\n            quickPick.dispose();\r\n        });\r\n\r\n        quickPick.show();\r\n    }\r\n\r\n    /**\r\n     * å»ºç«‹ QuickPick é …ç›®\r\n     */\r\n    private buildItems(quotaData: QuotaData): QuotaQuickPickItem[] {\r\n        const items: QuotaQuickPickItem[] = [];\r\n\r\n        if (!quotaData.models || quotaData.models.length === 0) {\r\n            items.push({\r\n                label: '$(warning) No quota data available',\r\n                description: 'Click refresh to load quota'\r\n            });\r\n            return items;\r\n        }\r\n\r\n        if (this.groupingEnabled) {\r\n            // åˆ†çµ„æ¨¡å¼\r\n            const groups = this.groupingManager.createGroups(quotaData.models);\r\n\r\n            for (const group of groups) {\r\n                // åˆ†çµ„æ¨™é¡Œ\r\n                const icon = this.getStatusIcon(100 - group.aggregatedQuota.percentage);\r\n                const countdown = group.resetTime ? calculateCountdown(group.resetTime) : '';\r\n\r\n                items.push({\r\n                    label: `${icon} ${group.displayName}`,\r\n                    description: `${100 - group.aggregatedQuota.percentage}% remaining`,\r\n                    detail: countdown ? `â±ï¸ Resets ${countdown}` : undefined,\r\n                    groupId: group.id,\r\n                    kind: vscode.QuickPickItemKind.Separator\r\n                });\r\n\r\n                // åˆ†çµ„å…§çš„æ¨¡å‹\r\n                for (const model of group.models) {\r\n                    const modelIcon = this.getStatusIcon(model.remainingPercentage ?? (100 - model.percentage));\r\n                    items.push({\r\n                        label: `    ${modelIcon} ${model.name}`,\r\n                        description: `${model.remainingPercentage ?? (100 - model.percentage)}%`,\r\n                        detail: model.resetTime ? `Resets ${calculateCountdown(model.resetTime)}` : undefined,\r\n                        modelId: model.name,\r\n                        action: 'pin'\r\n                    });\r\n                }\r\n            }\r\n        } else {\r\n            // å¹³é¢æ¨¡å¼\r\n            const sortedModels = [...quotaData.models].sort((a, b) =>\r\n                (a.remainingPercentage ?? (100 - a.percentage)) - (b.remainingPercentage ?? (100 - b.percentage))\r\n            );\r\n\r\n            for (const model of sortedModels) {\r\n                const remainingPct = model.remainingPercentage ?? (100 - model.percentage);\r\n                const icon = this.getStatusIcon(remainingPct);\r\n                const countdown = model.resetTime ? calculateCountdown(model.resetTime) : '';\r\n\r\n                items.push({\r\n                    label: `${icon} ${model.name}`,\r\n                    description: `${remainingPct}% remaining`,\r\n                    detail: countdown ? `â±ï¸ Resets ${countdown}` : undefined,\r\n                    modelId: model.name,\r\n                    action: 'pin'\r\n                });\r\n            }\r\n        }\r\n\r\n        return items;\r\n    }\r\n\r\n    /**\r\n     * æ›´æ–°æŒ‰éˆ•\r\n     */\r\n    private updateButtons(): vscode.QuickInputButton[] {\r\n        return [\r\n            {\r\n                iconPath: new vscode.ThemeIcon('refresh'),\r\n                tooltip: t('quickpick.refresh') || 'Refresh Quota'\r\n            },\r\n            {\r\n                iconPath: new vscode.ThemeIcon(this.groupingEnabled ? 'list-tree' : 'list-flat'),\r\n                tooltip: this.groupingEnabled\r\n                    ? (t('quickpick.disableGrouping') || 'Disable Grouping')\r\n                    : (t('quickpick.enableGrouping') || 'Enable Grouping')\r\n            },\r\n            {\r\n                iconPath: new vscode.ThemeIcon('gear'),\r\n                tooltip: t('quickpick.settings') || 'Settings'\r\n            }\r\n        ];\r\n    }\r\n\r\n    /**\r\n     * å–å¾—ç‹€æ…‹åœ–ç¤º\r\n     */\r\n    private getStatusIcon(percent: number): string {\r\n        if (percent >= 50) return 'ğŸŸ¢';\r\n        if (percent >= 20) return 'ğŸŸ¡';\r\n        if (percent > 0) return 'ğŸ”´';\r\n        return 'âšª';\r\n    }\r\n\r\n    /**\r\n     * ç½®é ‚æ¨¡å‹åˆ°ç‹€æ…‹åˆ—\r\n     */\r\n    private async pinModel(modelId: string): Promise<void> {\r\n        const config = vscode.workspace.getConfiguration('antigravity-plus.quota');\r\n        const pinnedModels = config.get<string[]>('pinnedModels') || [];\r\n\r\n        if (!pinnedModels.includes(modelId)) {\r\n            pinnedModels.push(modelId);\r\n            await config.update('pinnedModels', pinnedModels, vscode.ConfigurationTarget.Global);\r\n        }\r\n    }\r\n\r\n    public dispose(): void {\r\n        this.disposables.forEach(d => d.dispose());\r\n    }\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\core\\quota-monitor\\status-bar-format.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\extension.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\i18n\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\providers\\antigravity-usage.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\providers\\cdp-client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\test\\e2e\\auto-approve.e2e.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\test\\e2e\\dashboard.e2e.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\test\\e2e\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\test\\e2e\\quota-monitor.e2e.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\test\\e2e\\runTest.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\test\\e2e\\status-bar.e2e.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\test\\e2e\\test-utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\test\\integration\\antigravity-mock.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\test\\integration\\auto-approve.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\test\\integration\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\test\\integration\\minimal.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\test\\integration\\quota-monitor.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\test\\integration\\runTest.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\test\\smoke\\extension.smoke.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\test\\smoke\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\test\\smoke\\runTest.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\test\\suite\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\test\\unit\\api-client.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\test\\unit\\auto-wakeup.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\test\\unit\\cdp-manager.node.test.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-var-requires","severity":1,"message":"Require statement not part of import statement.","line":46,"column":16,"nodeType":"CallExpression","messageId":"noVarReqs","endLine":46,"endColumn":33,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\test\\unit\\circuit-breaker.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\test\\unit\\countdown.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\test\\unit\\dashboard.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\test\\unit\\grouping.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\test\\unit\\i18n.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\test\\unit\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\test\\unit\\mock-vscode.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\test\\unit\\poller.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\test\\unit\\process-detector.strong.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\test\\unit\\rules-engine.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\test\\unit\\sb_formatter.test.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'model' is assigned a value but never used.","line":88,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":88,"endColumn":20,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\test\\unit\\status-bar.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\ui\\dashboard.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\ui\\status-bar.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'format' is assigned a value but never used.","line":198,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":198,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * ç‹€æ…‹åˆ—ç®¡ç†å™¨ (Enhanced)\r\n * \r\n * æ”¯æ´å¤šç¾¤çµ„é¡¯ç¤ºï¼Œæ¨£å¼åƒè€ƒ Antigravity Cockpit:\r\n * ğŸŸ¢ Group 1: 73% | ğŸŸ¢ Gemini 3 Flash: 87% | ğŸ”´ Group 3: 0%   âœ“ Auto Accept: ON   ğŸŒ Background: OFF   âš™ Settings\r\n */\r\n\r\nimport * as vscode from 'vscode';\r\nimport { QuotaData, UsageSession, ModelQuota } from '../core/quota-monitor/controller';\r\nimport { QuotaGroup } from '../core/quota-monitor/grouping';\r\nimport { calculateCountdown } from '../core/quota-monitor/countdown';\r\nimport { t } from '../i18n';\r\nimport { StatusBarFormatter } from '../core/quota-monitor/status-bar-format';\r\n\r\nexport type StatusBarFormat =\r\n    | 'icon'              // ğŸŸ¢\r\n    | 'percentage'        // 95%\r\n    | 'iconPercentage'    // ğŸŸ¢ 95%\r\n    | 'namePercentage'    // Sonnet: 95%\r\n    | 'iconNamePercentage'// ğŸŸ¢ Sonnet: 95%\r\n    | 'progressBar';      // â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘\r\n\r\nexport class StatusBarManager implements vscode.Disposable {\r\n    // Core Items\r\n    private quotaItem: vscode.StatusBarItem;  // å˜ä¸€é…é¡é¡¯ç¤ºé …ç›®ï¼ˆå°æ¨™ Cockpitï¼‰\r\n    private autoApproveItem: vscode.StatusBarItem;\r\n    private backgroundItem: vscode.StatusBarItem;\r\n    private settingsItem: vscode.StatusBarItem;\r\n\r\n    // Dynamic Group Items (å‚™ç”¨ï¼‰\r\n    private groupItems: vscode.StatusBarItem[] = [];\r\n    private readonly MAX_GROUPS = 5;\r\n\r\n    // State\r\n    private autoApproveEnabled = false;\r\n    private backgroundEnabled = false;\r\n    private currentQuotaData: QuotaData | undefined;\r\n    private currentGroups: QuotaGroup[] = [];\r\n    private countdownTimer: NodeJS.Timeout | undefined;\r\n\r\n    // Formatter\r\n    private formatter: StatusBarFormatter;\r\n\r\n    constructor(private context: vscode.ExtensionContext, formatter?: StatusBarFormatter) {\r\n        this.formatter = formatter || new StatusBarFormatter();\r\n\r\n        // === å»ºç«‹å›ºå®šé …ç›® (å³è‡³å·¦å„ªå…ˆç´š: ä½æ•¸å­— = æ›´é å³) ===\r\n\r\n        // 0. Quota Display (æœ€å·¦é‚Šé…é¡é¡¯ç¤º - å°æ¨™ Cockpit)\r\n        this.quotaItem = vscode.window.createStatusBarItem(\r\n            vscode.StatusBarAlignment.Right,\r\n            201\r\n        );\r\n        this.quotaItem.command = 'antigravity-plus.openDashboard';\r\n        this.quotaItem.text = `$(sync~spin) ${t('statusBar.quota.loading') || 'é…é¡è¼‰å…¥ä¸­...'}`;\r\n        this.quotaItem.tooltip = t('statusBar.quota.loading') || 'Loading quota...';\r\n\r\n        // 1. Auto Accept (æœ€å³é‚Š)\r\n        this.autoApproveItem = vscode.window.createStatusBarItem(\r\n            vscode.StatusBarAlignment.Right,\r\n            200\r\n        );\r\n        this.autoApproveItem.command = 'antigravity-plus.toggleAutoApprove';\r\n\r\n        // 2. Background Status\r\n        this.backgroundItem = vscode.window.createStatusBarItem(\r\n            vscode.StatusBarAlignment.Right,\r\n            199\r\n        );\r\n        this.backgroundItem.command = 'antigravity-plus.toggleAutoWakeup';\r\n\r\n        // 3. Settings (æœ€å·¦é‚Šçš„å›ºå®šé …ç›®)\r\n        this.settingsItem = vscode.window.createStatusBarItem(\r\n            vscode.StatusBarAlignment.Right,\r\n            198\r\n        );\r\n        this.settingsItem.text = `$(beaker) Antigravity+`;\r\n        this.settingsItem.tooltip = t('statusBar.settings.tooltip') || 'Open Antigravity Plus Settings';\r\n        this.settingsItem.command = 'antigravity-plus.openDashboard';\r\n\r\n        // === åˆå§‹åŒ–ç‹€æ…‹ (åœ¨å»ºç«‹å®Œæ‰€æœ‰é …ç›®å¾Œ) ===\r\n        this.updateAutoApproveState(false);\r\n        this.updateBackgroundState(false);\r\n\r\n        // === é¡¯ç¤ºé …ç›® ===\r\n        this.quotaItem.show();\r\n        this.autoApproveItem.show();\r\n        this.settingsItem.show();\r\n        // backgroundItem.show() ç”± updateAutoApproveState(true) æ§åˆ¶\r\n\r\n        // è¨»å†Šæ¸…ç†\r\n        context.subscriptions.push(\r\n            this.quotaItem,\r\n            this.autoApproveItem,\r\n            this.backgroundItem,\r\n            this.settingsItem\r\n        );\r\n\r\n        // å•Ÿå‹•å€’æ•¸è¨ˆæ™‚æ›´æ–°\r\n        this.startCountdownUpdates();\r\n    }\r\n\r\n    // ========== Auto Approve ==========\r\n\r\n    /**\r\n     * æ›´æ–°è‡ªå‹•æ ¸å‡†ç‹€æ…‹\r\n     */\r\n    public updateAutoApproveState(enabled: boolean): void {\r\n        this.autoApproveEnabled = enabled;\r\n\r\n        if (!this.autoApproveItem || !this.backgroundItem) return;\r\n\r\n        if (enabled) {\r\n            this.autoApproveItem.text = `$(check) Auto Accept: ON`;\r\n            this.autoApproveItem.backgroundColor = new vscode.ThemeColor('statusBarItem.warningBackground');\r\n            // âœ… å°æ¨™ Auto Accept Agent: é–‹å•Ÿæ™‚é¡¯ç¤º Background é …ç›®\r\n            this.backgroundItem.show();\r\n        } else {\r\n            this.autoApproveItem.text = `$(circle-slash) Auto Accept: OFF`;\r\n            this.autoApproveItem.backgroundColor = undefined;\r\n            // âœ… å°æ¨™ Auto Accept Agent: é—œé–‰æ™‚éš±è— Background é …ç›®\r\n            this.backgroundItem.hide();\r\n        }\r\n\r\n        this.autoApproveItem.tooltip = t('statusBar.autoApprove.tooltip');\r\n    }\r\n\r\n    // ========== Background (Auto Wake-up) ==========\r\n\r\n    /**\r\n     * æ›´æ–°èƒŒæ™¯åŸ·è¡Œç‹€æ…‹\r\n     */\r\n    public updateBackgroundState(enabled: boolean): void {\r\n        this.backgroundEnabled = enabled;\r\n\r\n        if (!this.backgroundItem) return;\r\n\r\n        if (enabled) {\r\n            this.backgroundItem.text = `$(globe) Background: ON`;\r\n            this.backgroundItem.backgroundColor = new vscode.ThemeColor('statusBarItem.prominentBackground');\r\n        } else {\r\n            this.backgroundItem.text = `$(globe) Background: OFF`;\r\n            this.backgroundItem.backgroundColor = undefined;\r\n        }\r\n\r\n        this.backgroundItem.tooltip = t('statusBar.background.tooltip') || 'Auto Wake-up Background Status';\r\n    }\r\n\r\n    // ========== Quota Groups ==========\r\n\r\n    /**\r\n     * è¨­å®šè¼‰å…¥ç‹€æ…‹ (å°æ¨™ Cockpit setLoading)\r\n     */\r\n    public setLoading(text?: string): void {\r\n        this.quotaItem.text = `$(sync~spin) ${text || t('statusBar.quota.loading') || 'Loading...'}`;\r\n        this.quotaItem.backgroundColor = undefined;\r\n    }\r\n\r\n    /**\r\n     * è¨­å®šå°±ç·’ç‹€æ…‹ (å°æ¨™ Cockpit setReady)\r\n     */\r\n    public setReady(): void {\r\n        this.quotaItem.text = `$(rocket) ${t('statusBar.quota.ready') || 'Ready'}`;\r\n        this.quotaItem.backgroundColor = undefined;\r\n    }\r\n\r\n    /**\r\n     * è¨­å®šéŒ¯èª¤ç‹€æ…‹ (å°æ¨™ Cockpit setError)\r\n     */\r\n    public setError(message: string): void {\r\n        this.quotaItem.text = `$(error) ${t('statusBar.quota.error') || 'Error'}`;\r\n        this.quotaItem.tooltip = message;\r\n        this.quotaItem.backgroundColor = new vscode.ThemeColor('statusBarItem.errorBackground');\r\n    }\r\n\r\n    /**\r\n     * è¨­å®šé›¢ç·šç‹€æ…‹ (å°æ¨™ Cockpit setOffline)\r\n     */\r\n    public setOffline(): void {\r\n        this.quotaItem.text = `$(error) ${t('statusBar.quota.offline') || 'Offline'}`;\r\n        this.quotaItem.backgroundColor = new vscode.ThemeColor('statusBarItem.warningBackground');\r\n    }\r\n\r\n    /**\r\n     * æ›´æ–°é…é¡é¡¯ç¤º (å°æ¨™ Cockpit update)\r\n     * ä½¿ç”¨å–®ä¸€ quotaItem é¡¯ç¤ºæ‰€æœ‰æ¨¡å‹é…é¡\r\n     */\r\n    public updateQuota(data: QuotaData): void {\r\n        this.currentQuotaData = data;\r\n\r\n        if (!data.models || data.models.length === 0) {\r\n            this.quotaItem.text = `$(rocket) No Data`;\r\n            return;\r\n        }\r\n\r\n        // æ ¼å¼åŒ–é…é¡æ–‡å­—ï¼ˆå°æ¨™ Cockpit çš„é¡¯ç¤ºæ–¹å¼ï¼‰\r\n        const config = vscode.workspace.getConfiguration('antigravity-plus');\r\n        const format = config.get<StatusBarFormat>('quotaMonitor.displayStyle') || 'iconNamePercentage';\r\n\r\n        const parts: string[] = [];\r\n        let minPercentage = 100;\r\n\r\n        // æœ€å¤šé¡¯ç¤º 3 å€‹æ¨¡å‹ï¼Œè¶…éå‰‡é¡¯ç¤ºæœ€ä½é…é¡çš„\r\n        const displayModels = data.models.slice(0, 3);\r\n\r\n        for (const model of displayModels) {\r\n            // ä½¿ç”¨æ–°çš„ Formatter é€²è¡Œæ ¼å¼åŒ–\r\n            const text = this.formatter.formatModel(model);\r\n            parts.push(text);\r\n\r\n            if (model.remainingPercentage !== undefined && model.remainingPercentage < minPercentage) {\r\n                minPercentage = model.remainingPercentage;\r\n            }\r\n        }\r\n        // è¨­å®š quotaItem æ–‡å­—\r\n        this.quotaItem.text = parts.join(' | ');\r\n        this.quotaItem.backgroundColor = undefined;\r\n\r\n        // è¨­å®šè­¦å‘ŠèƒŒæ™¯è‰²\r\n        if (minPercentage <= 10) {\r\n            this.quotaItem.backgroundColor = new vscode.ThemeColor('statusBarItem.errorBackground');\r\n        } else if (minPercentage <= 30) {\r\n            this.quotaItem.backgroundColor = new vscode.ThemeColor('statusBarItem.warningBackground');\r\n        }\r\n\r\n        // å»ºç«‹ tooltip\r\n        this.quotaItem.tooltip = this.buildQuotaTooltip(data);\r\n\r\n        // åŒæ™‚æ›´æ–° groups (ç”± Controller é€é updateGroups æ˜ç¢ºå‘¼å«ï¼Œä¸å†æ­¤è™•è‡ªå‹•è¨ˆç®—)\r\n        // if (data.models.length > 0) {\r\n        //     this.updateGroupsFromModels(data.models);\r\n        // }\r\n    }\r\n\r\n    /**\r\n     * å»ºç«‹é…é¡ Tooltip\r\n     */\r\n    private buildQuotaTooltip(data: QuotaData): vscode.MarkdownString {\r\n        const md = new vscode.MarkdownString();\r\n        md.isTrusted = true;\r\n        md.supportHtml = true;\r\n\r\n        md.appendMarkdown(`**ğŸš€ Antigravity Plus - Quota Monitor**\\n\\n`);\r\n\r\n        // è¡¨æ ¼æ¨™é¡Œ\r\n        md.appendMarkdown('| Model | Remaining | Reset |\\n');\r\n        md.appendMarkdown('| :--- | :--- | :--- |\\n');\r\n\r\n        for (const model of data.models) {\r\n            const remaining = 100 - model.percentage;\r\n            const icon = this.getStatusIcon(remaining);\r\n            const resetTime = model.resetTime\r\n                ? model.resetTime.toLocaleTimeString()\r\n                : '-';\r\n            md.appendMarkdown(`| ${icon} **${model.displayName}** | ${remaining}% | ${resetTime} |\\n`);\r\n        }\r\n\r\n        md.appendMarkdown(`\\n---\\n*Click to open Dashboard*`);\r\n        return md;\r\n    }\r\n\r\n    /**\r\n     * å¾åˆ†çµ„ç®¡ç†å™¨æ›´æ–°ç¾¤çµ„\r\n     */\r\n    public updateGroups(groups: QuotaGroup[]): void {\r\n        this.currentGroups = groups;\r\n        this.renderGroupItems();\r\n    }\r\n\r\n    /**\r\n     * å¾æ¨¡å‹æ¸…å–®å»ºç«‹é è¨­ç¾¤çµ„\r\n     */\r\n    private updateGroupsFromModels(models: ModelQuota[]): void {\r\n        // ç°¡åŒ–ç‰ˆï¼šæ¯å€‹æ¨¡å‹ä¸€å€‹ç¾¤çµ„ï¼ˆå¯¦éš›æ‡‰ç”± GroupingManager è™•ç†ï¼‰\r\n        const groups: QuotaGroup[] = models.slice(0, this.MAX_GROUPS).map((m, i) => ({\r\n            id: m.name,\r\n            name: m.name,\r\n            displayName: m.displayName,\r\n            models: [m],\r\n            aggregatedQuota: {\r\n                used: m.used,\r\n                total: m.total,\r\n                percentage: m.percentage\r\n            },\r\n            resetTime: m.resetTime,\r\n            isPinned: false,\r\n            order: i\r\n        }));\r\n\r\n        this.currentGroups = groups;\r\n        this.renderGroupItems();\r\n    }\r\n\r\n    /**\r\n     * æ¸²æŸ“ç¾¤çµ„é …ç›®\r\n     */\r\n    private renderGroupItems(): void {\r\n        // æ¸…é™¤èˆŠé …ç›®\r\n        this.groupItems.forEach(item => item.dispose());\r\n        this.groupItems = [];\r\n\r\n        const config = vscode.workspace.getConfiguration('antigravity-plus');\r\n        const format = config.get<StatusBarFormat>('quotaMonitor.displayStyle') || 'iconPercentage';\r\n\r\n        // å»ºç«‹æ–°é …ç›® (å„ªå…ˆç´šå¾ 100 é–‹å§‹ï¼Œéæ¸›)\r\n        this.currentGroups.forEach((group, index) => {\r\n            const item = vscode.window.createStatusBarItem(\r\n                vscode.StatusBarAlignment.Right,\r\n                100 - index\r\n            );\r\n\r\n            const remaining = 100 - group.aggregatedQuota.percentage;\r\n\r\n            const text = this.formatGroupText(group.displayName, remaining, format);\r\n\r\n            item.text = text;\r\n            item.tooltip = this.buildGroupTooltip(group);\r\n            item.command = 'antigravity-plus.openDashboard';\r\n\r\n            // è¨­å®šèƒŒæ™¯è‰²\r\n            if (remaining <= 10) {\r\n                item.backgroundColor = new vscode.ThemeColor('statusBarItem.errorBackground');\r\n            } else if (remaining <= 30) {\r\n                item.backgroundColor = new vscode.ThemeColor('statusBarItem.warningBackground');\r\n            }\r\n\r\n            item.show();\r\n            this.groupItems.push(item);\r\n            this.context.subscriptions.push(item);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * æ ¼å¼åŒ–ç¾¤çµ„æ–‡å­—\r\n     */\r\n    private formatGroupText(name: string, percent: number, format: StatusBarFormat): string {\r\n        const icon = this.getStatusIcon(percent);\r\n        const shortName = this.getShortName(name);\r\n\r\n        switch (format) {\r\n            case 'icon':\r\n                return icon;\r\n            case 'percentage':\r\n                return `${percent}%`;\r\n            case 'iconPercentage':\r\n                return `${icon} ${percent}%`;\r\n            case 'namePercentage':\r\n                return `${shortName}: ${percent}%`;\r\n            case 'iconNamePercentage':\r\n                return `${icon} ${shortName}: ${percent}%`;\r\n            case 'progressBar':\r\n                return this.formatProgressBar(percent);\r\n            default:\r\n                return `${icon} ${shortName}: ${percent}%`;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * å–å¾—ç‹€æ…‹åœ–ç¤º\r\n     */\r\n    public getStatusIcon(percent: number): string {\r\n        if (percent >= 50) return 'ğŸŸ¢';\r\n        if (percent >= 20) return 'ğŸŸ¡';\r\n        return 'ğŸ”´';\r\n    }\r\n\r\n    /**\r\n     * å–å¾—ç¸®çŸ­åç¨±\r\n     */\r\n    private getShortName(name: string): string {\r\n        const shortNames: Record<string, string> = {\r\n            'Gemini 3 Pro': 'Pro',\r\n            'Gemini 3 Flash': 'Flash',\r\n            'Gemini Pro': 'Pro',\r\n            'Gemini Flash': 'Flash',\r\n            'Claude Sonnet': 'Sonnet',\r\n            'Claude Opus': 'Opus',\r\n            'GPT-4o': '4o',\r\n            'GPT-4o Mini': '4o-mini'\r\n        };\r\n        return shortNames[name] || name.split(' ').pop() || name;\r\n    }\r\n\r\n    /**\r\n     * æ ¼å¼åŒ–é€²åº¦æ¢\r\n     */\r\n    private formatProgressBar(percent: number): string {\r\n        const filled = Math.round(percent / 12.5);\r\n        const empty = 8 - filled;\r\n        return 'â–ˆ'.repeat(filled) + 'â–‘'.repeat(empty);\r\n    }\r\n\r\n    /**\r\n     * å»ºç«‹ç¾¤çµ„ tooltip\r\n     */\r\n    private buildGroupTooltip(group: QuotaGroup): string {\r\n        const remaining = 100 - group.aggregatedQuota.percentage;\r\n        const lines = [\r\n            `ğŸ“Š ${group.displayName}`,\r\n            `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”`,\r\n            `${this.getStatusIcon(remaining)} Remaining: ${remaining}%`,\r\n            `Used: ${group.aggregatedQuota.used} / ${group.aggregatedQuota.total}`,\r\n        ];\r\n\r\n        if (group.resetTime) {\r\n            const countdown = calculateCountdown(group.resetTime);\r\n            lines.push(``, `â± Resets in: ${countdown.text}`);\r\n        }\r\n\r\n        if (group.models.length > 1) {\r\n            lines.push(``, `ğŸ“¦ Includes ${group.models.length} models`);\r\n        }\r\n\r\n        return lines.join('\\n');\r\n    }\r\n\r\n    // ========== Session (Legacy) ==========\r\n\r\n    /**\r\n     * æ›´æ–° Session é¡¯ç¤º (å¯é¸ï¼Œè‹¥è¦ä¿ç•™)\r\n     */\r\n    public updateSession(_session: UsageSession): void {\r\n        // Session é …ç›®å·²ç§»é™¤ï¼Œçµ±è¨ˆç”± Dashboard é¡¯ç¤º\r\n    }\r\n\r\n    // ========== Countdown Timer ==========\r\n\r\n    /**\r\n     * å•Ÿå‹•å€’æ•¸è¨ˆæ™‚æ›´æ–°\r\n     */\r\n    private startCountdownUpdates(): void {\r\n        this.countdownTimer = setInterval(() => {\r\n            // æ›´æ–°ç¾¤çµ„çš„ tooltip\r\n            if (this.currentGroups.length > 0) {\r\n                this.renderGroupItems();\r\n            }\r\n        }, 60000); // æ¯åˆ†é˜æ›´æ–°ä¸€æ¬¡\r\n    }\r\n\r\n    // ========== Utility ==========\r\n\r\n    /**\r\n     * åˆ·æ–°é¡¯ç¤ºï¼ˆèªè¨€è®Šæ›´æ™‚ï¼‰\r\n     */\r\n    public refresh(): void {\r\n        this.updateAutoApproveState(this.autoApproveEnabled);\r\n        this.updateBackgroundState(this.backgroundEnabled);\r\n        if (this.currentGroups.length > 0) {\r\n            this.renderGroupItems();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * æ›´æ–°è¨­å®š\r\n     */\r\n    public updateConfig(): void {\r\n        if (this.currentGroups.length > 0) {\r\n            this.renderGroupItems();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * é‡‹æ”¾è³‡æº\r\n     */\r\n    public dispose(): void {\r\n        if (this.countdownTimer) {\r\n            clearInterval(this.countdownTimer);\r\n        }\r\n        this.autoApproveItem.dispose();\r\n        this.backgroundItem.dispose();\r\n        this.settingsItem.dispose();\r\n        this.groupItems.forEach(item => item.dispose());\r\n    }\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\utils\\config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\SideProject\\vscode_plugins\\antigravity-plus\\src\\utils\\logger.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]}]
